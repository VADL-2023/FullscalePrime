<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fullscale Prime: Fullscale Prime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fullscale Prime
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Fullscale Prime </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> Welcome to the VADL 2023 software repository! The goal of this project was to autonomously run the team's payload. This involves launch-apogee-landing detection, RCB to properly place the key nacelle at the top, lift to elevate the key nacelle, and run the SDRs and cameras to autonomously decode APRS packets and perform the proper image processing actions. The code was written by Kush Hari, Meredith Hunter, Andrew Noonan, Matthew McGowan, and technically Eric Holst with README written by Kush Hari.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation</h1>
<p>This code is designed to work with a Raspberry Pi 4 with the Raspbian Bullseye operating system (but it could probably work with Ubuntu or Ubuntu MATE). The only major installation is OpenCV. OpenCV is an open source computer vision library with lots of cool and efficient CV algorithms, so you don't got to write it yourself.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
OpenCV Installation</h2>
<p>The tutorial I installed OpenCV was a bit extra, but it works. You may have issues with the computer crashing, which you can fix with the swap memory (see end of tutorial) </p><div class="fragment"><div class="line">sudo apt-get -y purge wolfram-engine</div>
<div class="line">sudo apt-get -y purge libreoffice*</div>
<div class="line">sudo apt-get -y clean</div>
<div class="line">sudo apt-get -y autoremove</div>
<div class="line"> </div>
<div class="line">echo &quot;OpenCV installation by learnOpenCV.com&quot;</div>
<div class="line">cvVersion=&quot;master&quot;</div>
<div class="line"> </div>
<div class="line"># Clean build directories</div>
<div class="line">rm -rf opencv/build</div>
<div class="line">rm -rf opencv_contrib/build</div>
<div class="line"> </div>
<div class="line"># Create directory for installation</div>
<div class="line">mkdir installation</div>
<div class="line">mkdir installation/OpenCV-&quot;$cvVersion&quot;</div>
<div class="line"> </div>
<div class="line"># Save current working directory</div>
<div class="line">cwd=$(pwd)</div>
<div class="line"> </div>
<div class="line">sudo apt -y update</div>
<div class="line">sudo apt -y upgrade</div>
<div class="line"> </div>
<div class="line">sudo apt-get -y remove x264 libx264-dev</div>
<div class="line"> </div>
<div class="line">## Install dependencies</div>
<div class="line">sudo apt-get -y install build-essential checkinstall cmake pkg-config yasm</div>
<div class="line">sudo apt-get -y install git gfortran</div>
<div class="line">sudo apt-get -y install libjpeg8-dev libjasper-dev libpng12-dev</div>
<div class="line"> </div>
<div class="line">sudo apt-get -y install libtiff5-dev</div>
<div class="line"> </div>
<div class="line">sudo apt-get -y install libtiff-dev</div>
<div class="line"> </div>
<div class="line">sudo apt-get -y install libavcodec-dev libavformat-dev libswscale-dev libdc1394-22-dev</div>
<div class="line">sudo apt-get -y install libxine2-dev libv4l-dev</div>
<div class="line">cd /usr/include/linux</div>
<div class="line">sudo ln -s -f ../libv4l1-videodev.h videodev.h</div>
<div class="line">cd $cwd</div>
<div class="line"> </div>
<div class="line">sudo apt-get -y install libgstreamer0.10-dev libgstreamer-plugins-base0.10-dev</div>
<div class="line">sudo apt-get -y install libgtk2.0-dev libtbb-dev qt5-default</div>
<div class="line">sudo apt-get -y install libatlas-base-dev</div>
<div class="line">sudo apt-get -y install libmp3lame-dev libtheora-dev</div>
<div class="line">sudo apt-get -y install libvorbis-dev libxvidcore-dev libx264-dev</div>
<div class="line">sudo apt-get -y install libopencore-amrnb-dev libopencore-amrwb-dev</div>
<div class="line">sudo apt-get -y install libavresample-dev</div>
<div class="line">sudo apt-get -y install x264 v4l-utils</div>
<div class="line"> </div>
<div class="line"># Optional dependencies</div>
<div class="line">sudo apt-get -y install libprotobuf-dev protobuf-compiler</div>
<div class="line">sudo apt-get -y install libgoogle-glog-dev libgflags-dev</div>
<div class="line">sudo apt-get -y install libgphoto2-dev libeigen3-dev libhdf5-dev doxygen</div>
<div class="line"> </div>
<div class="line">git clone https://github.com/opencv/opencv.git</div>
<div class="line">cd opencv</div>
<div class="line">git checkout $cvVersion</div>
<div class="line">cd ..</div>
<div class="line"> </div>
<div class="line">git clone https://github.com/opencv/opencv_contrib.git</div>
<div class="line">cd opencv_contrib</div>
<div class="line">git checkout $cvVersion</div>
<div class="line">cd ..</div>
<div class="line"> </div>
<div class="line">cd opencv</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line"> </div>
<div class="line">cmake -D CMAKE_BUILD_TYPE=RELEASE \</div>
<div class="line">            -D CMAKE_INSTALL_PREFIX=$cwd/installation/OpenCV-&quot;$cvVersion&quot; \</div>
<div class="line">            -D INSTALL_C_EXAMPLES=ON \</div>
<div class="line">            -D INSTALL_PYTHON_EXAMPLES=ON \</div>
<div class="line">            -D WITH_TBB=ON \</div>
<div class="line">            -D WITH_V4L=ON \</div>
<div class="line">            -D OPENCV_PYTHON3_INSTALL_PATH=$cwd/OpenCV-$cvVersion-py3/lib/python3.5/site-packages \</div>
<div class="line">            -D WITH_QT=ON \</div>
<div class="line">            -D WITH_OPENGL=ON \</div>
<div class="line">            -D OPENCV_EXTRA_MODULES_PATH=../../opencv_contrib/modules \</div>
<div class="line">            -D BUILD_EXAMPLES=ON ..</div>
<div class="line"> </div>
<div class="line">make -j$(nproc)</div>
<div class="line">make install</div>
<div class="line"> </div>
<div class="line">sudo sed -i &#39;s/CONF_SWAPSIZE=1024/CONF_SWAPSIZE=100/g&#39; /etc/dphys-swapfile</div>
<div class="line">sudo /etc/init.d/dphys-swapfile stop</div>
<div class="line">sudo /etc/init.d/dphys-swapfile start</div>
<div class="line"> </div>
<div class="line">echo &quot;sudo modprobe bcm2835-v4l2&quot; &amp;amp;amp;amp;gt;&amp;amp;amp;amp;gt; ~/.profile</div>
</div><!-- fragment --><p> Based on this link: <a href="https://learnopencv.com/install-opencv-4-on-raspberry-pi/">https://learnopencv.com/install-opencv-4-on-raspberry-pi/</a></p>
<h1><a class="anchor" id="autotoc_md3"></a>
Other installations</h1>
<p>Since we get pigpio from source, it should automatically compile. You may be missing a few installations here and there, but you should be able to install them with apt.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Package Explanations/Running the Code</h1>
<p>To compile and build the code, run the following. You will see that all the other packages will build first, then the MainDriver package. This is because the MainDriver relies on the other packages to be compiled libraries before it can compile. The full payload code can be run with the following executable, but it is not recommended to run this cold as it relies on the payload to be perfectly setup. Also, always compile from the FullscalePrime directory, don't individually compile stuff in their own folders, just makes things messy. </p><div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
<div class="line">cd build/MainDriver</div>
<div class="line">sudo ./realDisplayTest</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Package Explanation</h1>
<p>This project has a lot of different components, so that's why there are so many packages. Each package written this year should have detailed comments. Some packages may not have detailed comments, but they have been previously verified to work. Here is a brief description on each package and if it is useful.</p>
<p>FieldTest: Includes a series of different starter tests we would run in the field to help debug issues quickly (Useful)</p>
<p>HFSM: Includes all of the states for the state machine (Useful)</p>
<p>ImageCapture: Has some random OpenCV image tests. (Meh, may have some useful stuff if you want to learn OpenCV, but poorly documented and may not work, sorry)</p>
<p>IMU: Includes wrapper code for the VN Library for IMU. This package was written in a previous year, and I don't know about the mutex stuff, but it works. (Useful)</p>
<p><a class="el" href="classLog.html" title="Log class to record flight results.">Log</a>: Includes code for the log to save flight data for easy integration with our MATLAB sim. This package was writtein in a previous year. (Useful)</p>
<p>MainDriver: The bread and butter, the meat and potatoes, the autobots and decepticons, this is where all the code comes together to make the target executable. (Useful)</p>
<p>MultithreadTest: Mini test to see how we can do multithreading in C++. (Meh, helpful to see some multithreading code, but it may not work)</p>
<p>PacketReception: Includes wrapper code for our TCP socket to receive APRS packets. (Useful)</p>
<p>pigpio-master: Source code to allow for GPIO interaction. Fun fact, it is Pi GPIO and not Pig Pio. (Useful)</p>
<p>SerialCute++ (Name credits go to Meredith): Wrapper code for Serial communication objects. (Useful)</p>
<p>ServoTest: Mini test to see how to move servo in C++ (Not Useful)</p>
<p><a class="el" href="classStepper.html" title="Stepper Library Interface.">Stepper</a>: Includes stepper motor library for Raspberry Pi. Based on Arduino library. (Useful)</p>
<p>VectorNav: VN-100 library provided by VectorNav. Allows us to read IMU data from each register at 20 Hz. If you want 2 registers, you get 10 Hz. (Useful)</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Bash/Python Script Explanations</h1>
<p>cam_assignment.bash: Looks at which cameras are connected to the Pi, assigns them with static names based on which port they are plugged in (Useful) kill_sdr.bash: Kills all SDR running processes. Important because SDR can't run if it is already running (Useful) processaltitude.py: Interprets log files to make altitude plots (Meh, MATLAB sims are better. Cool to get this running and see plots on the field, but it might not work anymore) video_concat scripts: We save the flight videos in increments, so this will just merge it all together (Meh, cool to get this running if relevant, but probably doesn't work anymore)</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Limitations</h1>
<p>The code in its current form did not successfully operate in the NASA USLI competition despite functioning through all of our tests. We were able to successfully record flight video, perform RCB, detect all cameras and SDRS post-landing, and lift. However, during the lift, we lost all USB connections despite no hardware disruptions. With a software reboot, we were able to successfully execute the payload. Further testing revealed that this error happens 5-10% of the time. The leading reason for failure is the fact that we powered the Raspberry Pi with GPIO pins, rather than the USB-C or barrel jack port. This is bad because while it is safe voltage-wise, you can only run limited current through the GPIO pins. Perhaps when running the camera, the current spiked up, leading to undefined behavior of the USBs disconnecting. However, this should be thouroughly tested. <a href="https://forums.raspberrypi.com/viewtopic.php?t=196531">https://forums.raspberrypi.com/viewtopic.php?t=196531</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
